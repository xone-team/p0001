<?xml version="1.0" encoding="UTF-8"?>  <!DOCTYPE mapper   PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"  "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<mapper namespace="com.xone.model.hibernate.mybatis.mapper.PurchaseMapper">
<!--     <resultmap id="UserMap" type="User"> -->
<!--         <result column="ID" property="userId"> -->
<!--         <result column="NAME" property="userName"> -->
<!--     </resultmap> -->	
	<select id="findPurchaseListWithUser" parameterType="java.util.Map" resultType="java.util.Map">
        select p.*
        from t_purchase p left join t_user u on p.user_created = u.id 
       	<include refid="findPurchaseWhere"/>
       	order by p.date_created
       	<include refid="limit"/>
	</select>
	<select id="findPurchaseCountWithUser" parameterType="java.util.Map" resultType="int">
        select count(*)
        from t_purchase p left join t_user u on p.user_created = u.id 
       	<include refid="findPurchaseWhere"/>
	</select>
	<sql id="limit">
       	<if test="offsetIndex != null and maxResult != null">
       	    limit ${offsetIndex} , ${maxResult}
       	</if>
	</sql>
	<sql id="findPurchaseWhere">
        <where>
            <if test="id != null">
				and p.id = #{id}
			</if>
            <if test="gtDateCreated != null">
				<![CDATA[and p.date_created > #{gtDateCreated}]]>
			</if>
            <if test="ltDateCreated != null">
                <![CDATA[and p.date_created < #{ltDateCreated}]]>
			</if>
            <if test="purchaseName != null">
				and p.purchase_name like CONCAT('%', #{purchaseName}, '%')
			</if>
            <if test="purchaseType != null">
				and p.purchase_type like CONCAT('%', #{purchaseType}, '%')
			</if>
            <if test="purchaseAddress != null">
				and p.purchase_address like CONCAT('%', #{purchaseAddress}, '%')
			</if>
            <if test="checkStatus != null">
				and p.check_status = #{checkStatus}
			</if>
            <if test="flagDeleted != null">
				and p.flag_deleted = #{flagDeleted}
			</if>
            <if test="userCreated != null">
				and p.user_created = #{userCreated}
			</if>
        </where>
	</sql>
</mapper>